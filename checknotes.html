<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Notes - Mozakra</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    <style>
        :root { --main-blue: #6f93db; --accent-blue: #00cfff; --danger: #ff4d4d; --white: #ffffff; --gray-light: #f8fbff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background-color: var(--main-blue); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .admin-card { background: var(--white); width: 100%; max-width: 600px; min-height: 550px; border-radius: 40px; padding: 40px; box-shadow: 0 25px 50px rgba(0,0,0,0.2); display: flex; flex-direction: column; text-align: center; }
        .logo img { width: 130px; margin-bottom: 20px; }
        h2 { font-family: 'Montserrat', sans-serif; font-size: 22px; color: #2d3748; margin-bottom: 20px; }
        #status-msg { padding: 12px; border-radius: 12px; font-size: 13px; margin-bottom: 15px; display: none; }
        .table-wrapper { flex: 1; overflow-y: auto; border-radius: 20px; background: var(--gray-light); padding: 10px; max-height: 350px; border: 1px solid #edf2f7; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; font-size: 10px; color: #a0aec0; text-transform: uppercase; padding: 12px; }
        td { padding: 15px; font-size: 14px; color: #4a5568; border-bottom: 1px solid #eee; text-align: left; }
        .delete-btn { background: #fff5f5; color: var(--danger); border: none; padding: 7px 12px; border-radius: 8px; cursor: pointer; font-size: 11px; font-weight: bold; }
        .btn-refresh { background: var(--accent-blue); color: white; border: none; padding: 18px; border-radius: 18px; margin-top: 20px; font-weight: 800; cursor: pointer; width: 100%; font-size: 16px; }
        .back-link { display: inline-block; margin-top: 20px; color: var(--main-blue); text-decoration: none; font-weight: bold; font-size: 13px; }
    </style>
</head>
<body>
    <div class="admin-card">
        <div class="logo"><img src="assets/Rectangle-6.png" alt="Mozakra"></div>
        <h2>Student Notes</h2>
        <div id="status-msg"></div>
        <div class="table-wrapper">
            <table>
                <thead><tr><th>Content</th><th style="text-align: right;">Action</th></tr></thead>
                <tbody id="notes-list"><tr><td colspan="2" style="text-align:center;">Loading...</td></tr></tbody>
            </table>
        </div>
        <button class="btn-refresh" onclick="fetchNotes()">REFRESH DATA</button>
        <a href="admin.html" class="back-link">‚Üê Back to Admin Panel</a>
    </div>

    <script>
        const API_BASE = "https://mozakra-production.up.railway.app/api";

        function updateStatus(text, isError = false) {
            const msg = document.getElementById("status-msg");
            msg.innerText = text; msg.style.display = "block";
            msg.style.backgroundColor = isError ? "#fff5f5" : "#f0fff4";
            msg.style.color = isError ? "#c53030" : "#2f855a";
        }

        async function fetchNotes() {
            const token = localStorage.getItem("token");
            const list = document.getElementById("notes-list");
            if (!token) { window.location.href = "login.html"; return; }

            try {
                const res = await fetch(`${API_BASE}/get-notes`, {
                    method: "GET",
                    headers: { "Authorization": `Bearer ${token.trim()}` }
                });

                if (res.status === 401) {
                    updateStatus("Session Expired. Please Re-login.", true);
                    return;
                }

                const data = await res.json();
                const notes = data.notes || data.data || [];
                list.innerHTML = notes.length ? "" : "<tr><td colspan='2' style='text-align:center;'>No notes found.</td></tr>";

                notes.forEach(n => {
                    list.insertAdjacentHTML('beforeend', `<tr><td>${n.description}</td><td style="text-align: right;"><button class="delete-btn" onclick="deleteNote('${n._id}')">Delete</button></td></tr>`);
                });
                updateStatus("Data Updated!");
            } catch (err) { updateStatus("Network Error. Run from GitHub Pages.", true); }
        }

        async function deleteNote(id) {
            const token = localStorage.getItem("token");
            if(!confirm("Are you sure?")) return;
            try {
                const res = await fetch(`${API_BASE}/note/${id}`, {
                    method: "DELETE",
                    headers: { "Authorization": `Bearer ${token.trim()}` }
                });
                if(res.ok) fetchNotes(); else updateStatus("Delete failed.", true);
            } catch (e) { alert("Error connecting."); }
        }
        window.onload = fetchNotes;
    </script>
</body>
</html>
