<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>

<style>
body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: #0f172a;
  color: white;
}

.top-bar {
  padding: 16px 30px;
  background: #020617;
}

.tabs span {
  margin-right: 20px;
  cursor: pointer;
  opacity: .6;
}

.active {
  opacity: 1;
  font-weight: bold;
}

.screen {
  display: none;
  padding: 40px;
}

.screen.show {
  display: block;
}

input, button {
  width: 100%;
  margin-bottom: 12px;
  padding: 12px;
  border-radius: 8px;
  border: none;
}
button {
  background: #4fc3f7;
  font-weight: bold;
}
</style>
</head>

<body>

<header class="top-bar">
  <div class="tabs">
    <span onclick="show('reset')" class="active">RESET PASSWORD</span>
    <span onclick="show('upload')">UPLOAD FILES</span>
    <span onclick="show('create')">CREATE ACCOUNT</span>
  </div>
</header>

<section id="reset" class="screen show">
  <input placeholder="USER NAME">
  <input placeholder="NEW PASSWORD" type="password">
  <button>Reset</button>
</section>

<section id="upload" class="screen">
  <input type="file" id="pdfFile">
  <button onclick="uploadPDF()">Upload PDF</button>
</section>

<section id="create" class="screen">
  <input id="cu" placeholder="USER NAME">
  <input id="ce" placeholder="EMAIL">
  <input id="cp" placeholder="PASSWORD">
  <button onclick="createAccount()">Create</button>
</section>

<script>
/* ===== AUTH GUARD ===== */
const token = localStorage.getItem("token");
const user = JSON.parse(localStorage.getItem("user") || "{}");

if (!token || user.role !== "admin") {
  window.location.href = "login.html";
}

/* ===== UI ===== */
function show(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("show"));
  document.querySelectorAll(".tabs span").forEach(t => t.classList.remove("active"));
  document.getElementById(id).classList.add("show");
  event.target.classList.add("active");
}

/* ===== ACTIONS ===== */
function uploadPDF() {
  const file = pdfFile.files[0];
  if (!file) return alert("Choose PDF");

  const fd = new FormData();
  fd.append("pdf", file);

  fetch("https://mozakra-production.up.railway.app/api/upload", {
    method: "POST",
    headers: { Authorization: "Bearer " + token },
    body: fd
  })
  .then(r => r.ok ? alert("Uploaded") : alert("Failed"));
}

function createAccount() {
  fetch("https://mozakra-production.up.railway.app/api/auth/register", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: "Bearer " + token
    },
    body: JSON.stringify({
      username: cu.value,
      email: ce.value,
      password: cp.value
    })
  })
  .then(r => r.ok ? alert("Created") : alert("Failed"));
}
</script>

</body>
</html>
