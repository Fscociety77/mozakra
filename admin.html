<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Mozakra</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            background: #6f93db; /* Ù†ÙØ³ Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© */
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, Helvetica, sans-serif; /* Ù†ÙØ³ Ø®Ø· Ø§Ù„Ù„ÙˆØ¬Ù† */
        }

        .admin-card {
            background: #fff;
            width: 380px; /* Ù†ÙØ³ Ø¹Ø±Ø¶ ÙƒØ§Ø±Øª Ø§Ù„Ù„ÙˆØ¬Ù† ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ */
            padding: 30px;
            border-radius: 20px; /* Ù†ÙØ³ Ø§Ù„Ø­ÙˆØ§Ù Ø§Ù„Ø¯Ø§Ø¦Ø±ÙŠØ© */
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .logo img {
            width: 120px;
            margin-bottom: 15px;
        }

        h2 {
            color: #333;
            font-size: 20px;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø¨Ø§Øª (Ø§Ù„Ø²Ø±Ø§ÙŠØ± Ø§Ù„Ù„ÙŠ ÙÙˆÙ‚) */
        .tabs {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .tabs span {
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            color: #888;
            transition: 0.3s;
        }

        .tabs span.active {
            color: #00cfff;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª - Ù†ÙØ³ Ø§Ù„Ù„ÙˆØ¬Ù† Ø¨Ø§Ù„Ø¸Ø¨Ø· */
        input {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        /* Ø§Ù„Ø²Ø±Ø§ÙŠØ± - Ù†ÙØ³ Ø§Ù„Ù„ÙˆØ¬Ù† */
        .btn-action {
            width: 100%;
            padding: 12px;
            background: #00cfff;
            border: none;
            color: #fff;
            font-size: 16px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .btn-logout {
            background: none;
            border: none;
            color: #ff4d4d;
            font-weight: bold;
            cursor: pointer;
            font-size: 14px;
            text-decoration: underline;
        }

        .screen { display: none; }
        .screen.show { display: block; }
    </style>
</head>
<body>

<div class="admin-card">
    <div class="logo">
        <img src="assets/Rectangle-6.png" alt="Mozakra">
    </div>

    <div class="tabs">
        <span id="t-reset" class="active" onclick="show('reset')">RESET</span>
        <span id="t-upload" onclick="show('upload')">UPLOAD</span>
        <span id="t-create" onclick="show('create')">CREATE</span>
    </div>

    <div id="reset" class="screen show">
        <h2>Reset Password</h2>
        <input id="rs-user" type="text" placeholder="Username">
        <input id="rs-pass" type="password" placeholder="New Password">
        <button class="btn-action">Update</button>
    </div>

    <div id="upload" class="screen">
        <h2>Upload PDF</h2>
        <input type="file" id="pdfFile">
        <button class="btn-action" onclick="uploadPDF()">Upload Now</button>
    </div>

    <div id="create" class="screen">
        <h2>Create Account</h2>
        <input id="cu" placeholder="User Name">
        <input id="ce" placeholder="Email">
        <input id="cp" type="password" placeholder="Password">
        <button class="btn-action" onclick="createAccount()">Create</button>
    </div>

    <button class="btn-logout" onclick="logout()">Logout</button>
</div>

<script>
    /* ===== Ø§Ù„Ø­Ù…Ø§ÙŠØ© ===== */
    const token = localStorage.getItem("token");
    const user = JSON.parse(localStorage.getItem("user") || "{}");
    
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ØµÙÙˆÙØ© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆØ¨ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ admin
    const isAdmin = user.roles && Array.isArray(user.roles) && user.roles.includes("admin");

    if (!token || !isAdmin) { 
        window.location.href = "login.html"; 
    }

    /* ===== Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØªØ§Ø¨Ø§Øª ===== */
    function show(id) {
        document.querySelectorAll(".screen").forEach(s => s.classList.remove("show"));
        document.querySelectorAll(".tabs span").forEach(t => t.classList.remove("active"));
        
        const targetScreen = document.getElementById(id);
        const targetTab = document.getElementById('t-' + id);
        
        if (targetScreen) targetScreen.classList.add("show");
        if (targetTab) targetTab.classList.add("active");
    }

    function logout() {
        localStorage.clear();
        window.location.href = "login.html";
    }

    /* ===== Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (APIs) ===== */

    // 1. Ø±ÙØ¹ Ù…Ù„Ù PDF
    async function uploadPDF() {
        const fileInput = document.getElementById("pdfFile");
        const file = fileInput.files[0];
        if (!file) return alert("Please select a PDF file");

        const fd = new FormData();
        fd.append("pdf", file);

        try {
            const res = await fetch("https://mozakra-production.up.railway.app/api/upload", {
                method: "POST",
                headers: { "Authorization": "Bearer " + token },
                body: fd
            });
            if (res.ok) alert("File Uploaded Successfully! âœ…");
            else alert("Upload Failed! âŒ");
        } catch (err) {
            alert("Network Error");
        }
    }

    // 2. Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
  async function createAccount() {
    const cu = document.getElementById("cu").value.trim();
    const ce = document.getElementById("ce").value.trim();
    const cp = document.getElementById("cp").value.trim();

    if (!cu || !ce || !cp) return alert("Please fill all fields");

    // Ø£Ù‡Ù… Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ù† api/list-upload Ø´ØºØ§Ù„
    const paths = [
        "/api/auth/signup",
        "/api/signup",
        "/api/user/register",
        "/api/users/register",
        "/api/register"
    ];

    const baseUrl = "https://mozakra-production.up.railway.app";
    
    for (let path of paths) {
        console.log("Testing path: " + path);
        try {
            const res = await fetch(baseUrl + path, {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json", 
                    "Authorization": "Bearer " + token 
                },
                body: JSON.stringify({ userName: cu, email: ce, password: cp })
            });

            if (res.status !== 404) {
                if (res.ok) {
                    alert("Success! The correct path is: " + path);
                    return;
                } else {
                    const errorData = await res.json();
                    alert("Path found (" + path + ") but server said: " + (errorData.message || "Error"));
                    return;
                }
            }
        } catch (err) {
            console.error("Error testing " + path, err);
        }
    }

    alert("Unfortunately, all common paths returned 404. Check your server routes file.");
}

    // 3. ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ (Reset Password)
    async function resetPassword() {
        const targetUser = document.getElementById("rs-user").value.trim();
        const newPass = document.getElementById("rs-pass").value.trim();

        if (!targetUser || !newPass) return alert("Fill username and new password");

        try {
            // Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ùˆ Ø§Ù„ØµØ­ÙŠØ­ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨ØªØ§Ø¹Ùƒ
            const res = await fetch("https://mozakra-production.up.railway.app/api/auth/reset-password", {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json", 
                    "Authorization": "Bearer " + token 
                },
                body: JSON.stringify({ userName: targetUser, newPassword: newPass })
            });
            if (res.ok) alert("Password Updated! ğŸ”");
            else alert("Failed to reset password.");
        } catch (err) {
            alert("Network Error");
        }
    }
</script>
</body>
</html>
